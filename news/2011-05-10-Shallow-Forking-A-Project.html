<!DOCTYPE html>

<html lange="en">
<head>
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>CoApp - Shallow Forking a Project</title>
    <meta name="description" content="">
    <meta name="author" content="Garrett Serack">

    <meta property="og:title" content="CoApp - Shallow Forking a Project"/>
    
        <meta property="og:type" content="article"/>
    
    <meta property="og:image" content="http://coapp.org/images/logo-small.png"/>
    <meta property="og:url" content="http://coapp.org/news/2011-05-10-Shallow-Forking-A-Project.html"/>
    <meta property="og:site_name" content="CoApp"/>
    <meta property="og:admins" content="CoApp - fearthecowboy"/>

    <meta name="docid" content="undefined" />
    <meta name="srclocation" content="https://github.com/coapp/coapp.org/blob/master/src/dynamic/news/2011-05-10-Shallow-Forking-A-Project.html.md" />

    <!-- Icons -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

    <!-- Shims: IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Styles -->
    <link href="/styles/style.css" rel="stylesheet"/>
    <link href="/styles/prettify.css" rel="stylesheet"/>
    <link href="/styles/mediaelementplayer.min.css" rel="stylesheet"  />
    
</head>
<body >
    
    <!-- Scripts -->
    <script src="/scripts/jquery-1.6.4.min.js"></script>
    <script src="/scripts/prettify.js"></script>
    <script src="/scripts/jquery.tweet.js"></script>
    <script src="/scripts/mediaelement-and-player.js"></script>
    <script src="/scripts/bootstrap/bootstrap-dropdown.js"></script>
    <div id="fb-root"></div>
      <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
      </script>
      <script type="text/javascript">
      (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    </script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-15630590-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <script>
        // $('#topbar').dropdown();
    </script>
    <!-- Markup -->
    <div class="topbar" data-dropdown="dropdown">
        <div class="fill">
            <div class="container-fluid">
                <h3><a href="/index.html"><image style="margin:0; padding:0; position:absolute; top:2px; left:-2px;" src="/images/logo-small_32x32.png"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CoApp</a></h3>
                <ul>
                      
                        
                        <li typeof="sioc:Page" about="/pages/news.html" class="">
                            <a href="/pages/news.html" property="dc:title">News</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/help.html" class="">
                            <a href="/pages/help.html" property="dc:title">Help</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/packages.html" class="">
                            <a href="/pages/packages.html" property="dc:title">Packages</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/publishers.html" class="">
                            <a href="/pages/publishers.html" property="dc:title">Publishers</a>
                        </li>

                        
                      
                        
                        <li class="dropdown" >
                            <a href="#" class="dropdown-toggle">Developers</a>
                            <ul class="dropdown-menu">
                                <li><a href="/pages/developers">Developer Tutorials</a></li>
                                <li class="divider"></li>
                                <li><a href="http://github.com/coapp"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp Source Repositories</a></li>
                                <li><a href="http://github.com/coapp-packages"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub"> Package Source Repositories</a></li>
                                <li class="divider"></li>
                                <li><a href="https://github.com/coapp/coapp.org/wiki"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > Developer Wiki</a></li>
                                <li><a href="https://github.com/coapp/coapp/issues"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp Bugtracker</a></li>
                                <li><a href="https://github.com/coapp/devtools/issues"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > DevTools Bugtracker</a></li>
                                <li class="divider"></li>
                                <li><a href="http://github.com/organizations/coapp"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp GitHub Home</a></li>
                            </ul>
                        </li>
                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/reference.html" class="">
                            <a href="/pages/reference.html" property="dc:title">Reference</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/about.html" class="">
                            <a href="/pages/about.html" property="dc:title">About</a>
                        </li>

                        
                    
                </ul>
                
                
            </div>
        </div>
    </div>
    <div class="wrapper">
    <div class="container-fluid pushdown">
        <div class="sidebar">
            
        </div> 
        <section id="content" class="content">
        <div class="spanonethird rightsidebox" > <!-- float:right; display: inline; veritical-align:top; -->
            
        </div> 
            <div class="spantwothirds">
            


<span style="display:inline-block;">
    <h1>Shallow Forking a Project</h1>
    <p>May 10 2011 by <b>Garrett Serack</b> <a href="http://twitter.com/#!/fearthecowboy">@fearthecowboy</a><br>
    <span class="label warning">Tags</span><span style="display:inline-block;">developer,coding,shallow-forking</span></p>
</span>
<span style="display:inline-block; float:right;">
    <br><br>
    <span style="margin-top:8px; height;100%; display:inline-block; "><g:plusone href="http://coapp.org/news/2011-05-10-Shallow-Forking-A-Project.html"></g:plusone></span>
    <div class="fb-like" style="top:-5px;" data-href="http://coapp.org/news/2011-05-10-Shallow-Forking-A-Project.html" data-layout="button_count" data-show-faces="true" data-colorscheme="dark" data-font="tahoma"></div>
</span>  
<hr>
<div id="post" class="post">
    <p>We're nearing the point where we're able to take open source projects and produce happy-shiny packages for them--uh yeah, <em>nearing</em>. <br /><br />It's gonna be a couple more weeks shaking out the tools that generate new Visual Studio project files for a given project and wire all that stuff up.</p>

<p>The good news though, is that we're ready to have people start shallow-forking projects and sticking them into <a href="http://github.com/coapp-packages">GitHub</a>. </p>

<h2>What's a "shallow-fork" you say?</h2>

<p>A <a href="http://bit.ly/lGYOb6">fork</a> happens when developers take a copy of source code from one software package and starts independent development on it, creating a distinct piece of software.  A shallow-fork is when the independent development continually brings forward changes from the original project, and attempts not to stray very far from it.  We do this so that we can make appropriate Windows changes (like new build scripts, or better API support) keep compatibility and not break the original project.  If the upstream project is willing to accept changes, great! If not (for whatever reason)... great! Either way, the package maintainer for the CoApp project will aim to keep the projects in sync as much as possible. </p>

<p>Linux distributions do this sort of thing all the time, in order to build packages for their specific version of Linux.  We're essentially following in the same footsteps, but following the procedure that I'm setting out here, so that we can eventually produce packages of software for CoApp.</p>

<h2>Can You Help?</h2>

<p>We're looking for people to start the leg-work for building packages right now, this means creating a fork in GitHub, and doing the work to get it compiling under Windows no matter how it's done (i.e., you can use a makefile, VS project files, a batch file... whatever). The idea is to just get a successful build that can be replicated on a known configuration--Visual Studio 2010 (even <a href="http://www.microsoft.com/express/Downloads/">VS 2010 express</a>), and the <a href="http://download.microsoft.com/download/A/6/A/A6AC035D-DA3F-4F0C-ADA4-37C8E5D34E3D/winsdk_web.exe">Windows SDK 7.1</a> ... We'll be automating the work later that creates well-built VS 2010 project files (and eventually other builds like mingw, etc), but that work will leverage the effort done now to create consistent shallow-forks.</p>

<h2>What do you need?</h2>

<ol>
<li><p>The aforementioned Visual Studio 2010 (the <a href="http://www.microsoft.com/express/Downloads/">express</a> version will do), and the <a href="http://download.microsoft.com/download/A/6/A/A6AC035D-DA3F-4F0C-ADA4-37C8E5D34E3D/winsdk_web.exe">Windows SDK 7.1</a>.</p></li>
<li><p><a href="https://github.com/signup/free">An account on GitHub</a>, and the ability to check stuff in (you can use <a href="http://code.google.com/p/msysgit/">msysgit</a> or <a href="http://code.google.com/p/tortoisegit/">tortoisegit</a> , or any other Git client for Windows even the <a href="http://mercurial.selenic.com/downloads/">Mercurial</a> plugin <a href="http://hg-git.github.com/">hg-git</a>, which lets you use Git repositories as if they were mercurial repositories. <em>(Note: I tried the hg-git plugin, and had to use the version <a href="https://github.com/sampsyo/hg-git">here</a> to get it to work)</em></p></li>
<li><p>The ability to build software using Visual Studio we need command line builds, but if you get it working from inside the IDE, we can show you how to automate that from the command line in a single step.</p></li>
<li><p>The ability to follow the pretty-darn-simple process below to produce the necessary build.</p></li>
<li><p>A current build of the CoApp tools. You can <a href="http://fearthecowboy.com/2011/04/26/weve-moved-coapp-code-hosting-to-github/">compile them yourself</a>, or just download my <a href="http://cdn.coapp.org/files/coapp-tools-snapshot.zip">latest snapshot build</a>. Make it easy on yourself, put them in a folder that's in the %PATH%.</p></li>
</ol>

<h2>Becoming a package maintainer</h2>

<p>The first thing is to get yourself added as a CoApp package-maintainer on GitHub no worries, signing up for this isn't a lifelong commitment. If you are interested in keeping it moving over the long haul, that's great, but even if you can just do up a few projects and get them checked in, we'll figure out the long term maintenance strategy later.</p>

<p>In order to get added to the package maintainer group you can send me a message on GitHub (fearthecowboy) or via <a href="mailto:<a href='mailto:garretts@microsoft.com'>garretts@microsoft.com</a>">email</a>, or heck, even just send me a <a href="http://twitter.com/home?status=Hey%2C+%40fearthecowboy%21+I%27d+like+to+become+a+%23CoApp+package+maintainer.+My+github+id+is+...">tweet</a>. All I need is your GitHub account id, and I'll add you to the group.</p>

<h2>Wait! Before You Begin...</h2>

<p>Since shallow-forking is intended to continually merge in changes from upstream, please keep changes to the project and its files to an absolute minimum don't do any unnecessary changes, don't reorganize the files, and don't try to rebuild a 'cleaner' build process.  You only need to get it to the point where it builds a viable output.  As we progress, we'll capture the data from the process and build shiny new project files that are much nicer expending extra effort now doesn't get you anywhere.</p>

<h2>If you run into trouble, and need help</h2>

<p>Check on IRC #coapp on freenode.net (try the <a href="http://webchat.freenode.net/">webclient</a> if you don't have IRC installed) if I'm there, I'm more than willing you help you thru the steps (and fix stuff that needs fixing), or failing that on the (mailing list)[<a href='https://launchpad.net/~coapp-developers'>https://launchpad.net/~coapp-developers</a>].</p>

<h2>The Process for Shallow-Forking for CoApp packages</h2>

<p>Quick Note: This is the first iteration of the Shallow-Fork process there are a number of deeper issues when forking projects that have multiple active branches, several configurations, etc.  What we're trying to do here is lay out a common approach so that as we proceed, we can automate as much as possible over the long run.   This procedure is likely to evolve quite a bit as we account for more scenarios and add support for additional compilers, configurations and build types.</p>

<ol>
<li><p>Find an open source C/C++ library or application that you'd like to fork.  You can select one off the list of things that we know we really need, or something else that of particular interest to you, and for which you'd like to see a CoApp package created.  If the project that you want to build has things that it depends on, you may need to go ahead and provide the shallow-fork for that as well we do not want to rely on binary builds that someone else has provided, that would be kinda silly.</p></li>
<li><p>Create a project in Github. Depending on what you're trying to make a fork of, you're going to do this in one of a few different ways.  If the project is already on GitHub, create a fork for it in the coapp-packages organization. If the source is posted as a zip file, unpack it and create the project manually. If it's in another VCS, there may be a generally-acceptable method to creating a fork in Git.  Bottom line, get the project into Github in a project in the coapp-packages organization.</p></li>
<li><p>Clone the source code into your working directory.</p></li>
<li><p>Create a folder in the root of the project called <strong>COPKG</strong>.</p></li>
<li><p>Create a text file in the folder called <strong>.buildinfo</strong> this is the file that you will be putting the build steps into. </p>

<p>The format of the .buildinfo file can be thought of something akin to a .css file.  Simple values need not be quoted (but it's ok to do so).  It supports comments ( double-slash and /* */), C# style string literals (may be preceded by an @ symbol to make a string multi-line).  </p>

<p>Inside the <strong>.buildinfo</strong> file,  insert the following: </p></li>
</ol>


<p>
<div class="highlight"><pre>#<span class="n">product</span><span class="p">-</span><span class="n">info</span>  <span class="p">{</span>
    <span class="n">product</span><span class="p">-</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="n">version</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="n">original</span><span class="p">-</span><span class="n">source</span><span class="p">-</span><span class="n">location</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="n">original</span><span class="p">-</span><span class="n">source</span><span class="p">-</span><span class="n">website</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="n">license</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="n">packager</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>

<p>You can fill in the values of each of the fields. An example for libjpeg (done by Rafael)</p>


<p>

<p>

<h3>Create one or more Build Configurations</h3>

<p>A "<strong>Build Configuration</strong>" is analogous to a build configuration with Visual Studio You can create builds for x86, x64, as well as for different flavors (static library vs. dynamic library) etc.  It's not necessary to explicitly create multiple build configuration for x86 and x64 if project compiles well under both without different commands (save for the selection of which platform).  You <strong>do</strong> want multiple configurations when the steps change between platforms (or you know that different files get processed in some libraries, there are separate files for x86 vs. x64), or if you have different expected outputs i.e. some libraries allow you to generate a static and a dynamic version of the same library).  Generally speaking, err on the side of caution and don't create multiple build configurations excessively for projects that behave themselves, we'll autogenerate the alternate configurations when we get around to creating new Visual Studio projects. </p>

<p>The build configuration syntax: </p>


<p>
<div class="highlight"><pre><span class="n">name</span>  <span class="p">{</span>
    <span class="cm">/* optional -- defaults to vc10-x86 */</span>
    <span class="n">compiler</span><span class="p">:</span> <span class="n">compiler</span><span class="p">-</span><span class="n">tag</span> <span class="p">;</span>
            <span class="c1">// currently supported values are vc10-x86 and vc10-x64 </span>
            <span class="c1">//... we&#39;ll add more compilers in the future.</span>

    <span class="cm">/* optional -- only used if this project has dependencies on others</span>
<span class="cm">                -- may be specified mutiple times */</span>
    <span class="n">uses</span><span class="p">:</span> <span class="n">bld</span><span class="p">-</span><span class="n">cfg</span><span class="p">=</span><span class="s">&quot;..\path&quot;</span> <span class="p">;</span>
            <span class="c1">// bld-cfg is the build configuration in dependent project</span>
            <span class="c1">// the &#39;blg-cfg=&#39; part can be omitted to depend on the default</span>
            <span class="c1">// path is to the root path of the dependent project that </span>
            <span class="c1">// contains a COPKG\.buildinfo file.</span>

    <span class="n">targets</span><span class="p">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="p">;</span>
            <span class="c1">// a comma seperated list of the binary files that are output </span>
            <span class="c1">// that are of significance</span>

    <span class="n">build</span><span class="p">-</span><span class="n">command</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
            <span class="c1">// either a single command line, or a batch script </span>
            <span class="c1">// that has the commands to build the targets listed above.</span>

    <span class="n">clean</span><span class="p">-</span><span class="n">command</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
            <span class="c1">// either a single command line, or a batch script </span>
            <span class="c1">// that has the commands to remove all temporary files </span>
            <span class="c1">// created during a build.</span>
<span class="p">}</span>
</pre></div>

<p>

<p>The above libjpeg example continued note that there isn't any <strong>uses</strong> option: </p>


<p>
<div class="highlight"><pre><span class="n">x86</span> <span class="p">{</span>
    <span class="n">compiler</span><span class="p">:</span> <span class="n">vc10</span><span class="p">-</span><span class="n">x86</span><span class="p">;</span>

    <span class="n">targets</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// main library</span>
        <span class="s">&quot;Release\jpeg.lib&quot;</span><span class="p">,</span>

        <span class="c1">// extra utilities</span>
        <span class="s">&quot;cjpeg\Release\cjpeg.exe&quot;</span><span class="p">,</span>
        <span class="s">&quot;djpeg\Release\djpeg.exe&quot;</span><span class="p">,</span>
        <span class="s">&quot;jpegtran\Release\jpegtran.exe&quot;</span><span class="p">,</span>
        <span class="s">&quot;rdjpgcom\Release\rdjpgcom.exe&quot;</span><span class="p">,</span>
        <span class="s">&quot;wrjpgcom\Release\wrjpgcom.exe&quot;</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="n">build</span><span class="p">-</span><span class="n">command</span><span class="p">:</span><span class="s">@&quot;</span>
<span class="s">        copy jconfig.vc jconfig.h       </span>
<span class="s">        copy makejsln.v10 makejsln.sln</span>
<span class="s">        copy makeasln.v10 makeasln.sln</span>
<span class="s">        copy makejvcx.v10 jpeg.vcxproj</span>
<span class="s">        copy makecvcx.v10 cjpeg.vcxproj</span>
<span class="s">        copy makedvcx.v10 djpeg.vcxproj</span>
<span class="s">        copy maketvcx.v10 jpegtran.vcxproj</span>
<span class="s">        copy makewvcx.v10 wrjpgcom.vcxproj</span>
<span class="s">        copy makervcx.v10 rdjpgcom.vcxproj</span>
<span class="s">        msbuild /p:Platform=Win32 /p:Configuration=Release makejsln.sln</span>
<span class="s">        msbuild /p:Platform=Win32 /p:Configuration=Release makeasln.sln</span>
<span class="s">    &quot;</span><span class="p">;</span>

    <span class="n">clean</span><span class="p">-</span><span class="n">command</span><span class="p">:</span><span class="s">@&quot;</span>
<span class="s">        attrib -S -H -R *</span>
<span class="s">        del /Q *.sdf *.suo *.sln *.vcxproj *.user jconfig.h 2&gt;NUL</span>
<span class="s">        rmdir /S /Q Release 2&gt;NUL</span>

<span class="s">        rmdir /S /Q cjpeg 2&gt;NUL</span>
<span class="s">        rmdir /S /Q djpeg 2&gt;NUL</span>
<span class="s">        rmdir /S /Q ipch 2&gt;NUL</span>
<span class="s">        rmdir /S /Q jpegtran 2&gt;NUL</span>
<span class="s">        rmdir /S /Q rdjpgcom 2&gt;NUL</span>
<span class="s">        rmdir /S /Q wrjpgcom 2&gt;NUL</span>
<span class="s">    &quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

<p>

<h3>Once you have the .buildinfo file complete, you can run the pTk tool from the command line (make sure you're in the root of the project).</h3>

<p><em>*You should be able to run a build: *</em></p>


<p>

<p>

<p><em>* ... and a clean :  *</em></p>


<p>

<p>

<p>... and a verify (where it builds, verifies the build targets, cleans, and verifies everything is clean): </p>


<p>

<p>

<p>Once it does what you expect, commit and push the clean version up to GitHub, and give me a shout.</p>
</div>

<!-- Disqus Comment System -->
<div id="disqus_thread"><div id="dsq-content"></div></div>
<ul id="dsq-comments"></ul>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'coapp'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    
    var disqus_identifier = '/news/2011-05-10-Shallow-Forking-A-Project.html';
    var disqus_url = 'http://www.coapp.org/news/2011-05-10-Shallow-Forking-A-Project.html';
    var disqus_title = "Shallow Forking a Project";
    var disqus_developer = 0; 
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </div>
        </section>
    </div>  
    <br>    
    <div class="push" ></div>
    </div>
    <footer class="footer">
        <div class="container-fluid">
        <p  style="float:left;">&copy; CoApp Contributors, 2011. 
        <br><sub>The source for this page can be found <a href="https://github.com/coapp/coapp.org/blob/master/src/dynamic/news/2011-05-10-Shallow-Forking-A-Project.html.md">in the github repository.</a></sub>
        </p>
        <p style="float:right;">
            This website was generated on Feb 01 2012 and has 137 documents
        </p>
        </div>
    </footer>
</body>
</html>