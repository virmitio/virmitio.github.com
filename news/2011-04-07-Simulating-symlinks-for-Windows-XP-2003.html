<!DOCTYPE html>

<html lange="en">
<head>
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>CoApp - Simulating Symlinks for Windows XP/2003</title>
    <meta name="description" content="">
    <meta name="author" content="Garrett Serack">

    <meta property="og:title" content="CoApp - Simulating Symlinks for Windows XP/2003"/>
    
        <meta property="og:type" content="article"/>
    
    <meta property="og:image" content="http://coapp.org/images/logo-small.png"/>
    <meta property="og:url" content="http://coapp.org/news/2011-04-07-Simulating-symlinks-for-Windows-XP-2003.html"/>
    <meta property="og:site_name" content="CoApp"/>
    <meta property="og:admins" content="CoApp - fearthecowboy"/>

    <meta name="docid" content="news:20110407" />
    <meta name="srclocation" content="https://github.com/coapp/coapp.org/blob/master/src/dynamic/news/2011-04-07-Simulating-symlinks-for-Windows-XP-2003.html.md" />

    <!-- Icons -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

    <!-- Shims: IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Styles -->
    <link href="/styles/style.css" rel="stylesheet"/>
    <link href="/styles/prettify.css" rel="stylesheet"/>
    <link href="/styles/mediaelementplayer.min.css" rel="stylesheet"  />
    
</head>
<body >
    
    <!-- Scripts -->
    <script src="/scripts/jquery-1.6.4.min.js"></script>
    <script src="/scripts/prettify.js"></script>
    <script src="/scripts/jquery.tweet.js"></script>
    <script src="/scripts/mediaelement-and-player.js"></script>
    <script src="/scripts/bootstrap/bootstrap-dropdown.js"></script>
    <div id="fb-root"></div>
      <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
      </script>
      <script type="text/javascript">
      (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    </script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-15630590-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <script>
        // $('#topbar').dropdown();
    </script>
    <!-- Markup -->
    <div class="topbar" data-dropdown="dropdown">
        <div class="fill">
            <div class="container-fluid">
                <h3><a href="/index.html"><image style="margin:0; padding:0; position:absolute; top:2px; left:-2px;" src="/images/logo-small_32x32.png"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CoApp</a></h3>
                <ul>
                      
                        
                        <li typeof="sioc:Page" about="/pages/news.html" class="">
                            <a href="/pages/news.html" property="dc:title">News</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/help.html" class="">
                            <a href="/pages/help.html" property="dc:title">Help</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/packages.html" class="">
                            <a href="/pages/packages.html" property="dc:title">Packages</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/publishers.html" class="">
                            <a href="/pages/publishers.html" property="dc:title">Publishers</a>
                        </li>

                        
                      
                        
                        <li class="dropdown" >
                            <a href="#" class="dropdown-toggle">Developers</a>
                            <ul class="dropdown-menu">
                                <li><a href="/pages/developers">Developer Tutorials</a></li>
                                <li class="divider"></li>
                                <li><a href="http://github.com/coapp"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp Source Repositories</a></li>
                                <li><a href="http://github.com/coapp-packages"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub"> Package Source Repositories</a></li>
                                <li class="divider"></li>
                                <li><a href="https://github.com/coapp/coapp.org/wiki"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > Developer Wiki</a></li>
                                <li><a href="https://github.com/coapp/coapp/issues"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp Bugtracker</a></li>
                                <li><a href="https://github.com/coapp/devtools/issues"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > DevTools Bugtracker</a></li>
                                <li class="divider"></li>
                                <li><a href="http://github.com/organizations/coapp"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp GitHub Home</a></li>
                            </ul>
                        </li>
                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/reference.html" class="">
                            <a href="/pages/reference.html" property="dc:title">Reference</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/about.html" class="">
                            <a href="/pages/about.html" property="dc:title">About</a>
                        </li>

                        
                    
                </ul>
                
                
            </div>
        </div>
    </div>
    <div class="wrapper">
    <div class="container-fluid pushdown">
        <div class="sidebar">
            
        </div> 
        <section id="content" class="content">
        <div class="spanonethird rightsidebox" > <!-- float:right; display: inline; veritical-align:top; -->
            
        </div> 
            <div class="spantwothirds">
            


<span style="display:inline-block;">
    <h1>Simulating Symlinks for Windows XP/2003</h1>
    <p>Apr 07 2011 by <b>Garrett Serack</b> <a href="http://twitter.com/#!/fearthecowboy">@fearthecowboy</a><br>
    <span class="label warning">Tags</span><span style="display:inline-block;">developer</span></p>
</span>
<span style="display:inline-block; float:right;">
    <br><br>
    <span style="margin-top:8px; height;100%; display:inline-block; "><g:plusone href="http://coapp.org/news/2011-04-07-Simulating-symlinks-for-Windows-XP-2003.html"></g:plusone></span>
    <div class="fb-like" style="top:-5px;" data-href="http://coapp.org/news/2011-04-07-Simulating-symlinks-for-Windows-XP-2003.html" data-layout="button_count" data-show-faces="true" data-colorscheme="dark" data-font="tahoma"></div>
</span>  
<hr>
<div id="post" class="post">
    <p>(cross-posted to the <a href="/developers/email.html" title="Mailing Lists">mailing list</a>)</p>

<p>As I mentioned in my last post, CoApp's design <a href="/news/2011-04-04-CoApp-package-composition.html" title="CoApp Package Composition">relies heavily</a> on the use of <a href="http://en.wikipedia.org/wiki/Symlinks">Symbolic Links</a> (symlinks)-a feature which is implemented fairly well in Windows Vista and beyond, but is missing in earlier versions of Windows.</p>

<p>Cygwin tried to work around the limitation by using shortcuts (.LNK files), which are files used by the Windows Shell for all the shortcuts in the start menu.  Not a bad way to go, but unfortunately, not very compatible with a lot of things, since most programs don't specially recognize .LNK files, although the POSIX emulation in cygwin did.</p>

<p>I was thinkin' that any acceptable solution should work with as much software as possible, without requiring special understanding, nor should any additional software be required (ie, a filter driver of some sort).</p>

<p>Our options then, are somewhat limited. On Windows XP and Windows Server 2003 we <strong>do</strong> have features like junctions (like symlinks, but only for directories, and only on the same volume), hard links (where more than one directory entry points to the same physical file) and alternate streams (the ability to store extra data with a file).</p>

<p>Hmmm.</p>

<p>Junctions seem to work fairly well for directories, with the caveat that actually manipulating junctions requires some tricky code with DeviceIOControl calls.</p>

<p>For file symlinks, I've used NTFS hardlinks, but when I create the link, I store some additional metadata with the file itself in an alternate stream (under the name "legacySymlinkInfo") which allows tools to find out what the canonical filename really is, and also to find out what other files are linked to the same physical file.</p>

<p>Of course, non-CoApp software could still manipulate these files for little regard as to their status as 'symlinks', so the legacySymlinkInfo really can't always be relied upon. But we can make a pretty good effort to 'clean-as-we-go' to keep that information up-to-date. If a file gets renamed or moved, the metadata may not be entirely accurate, so when we check the data, we make an attempt to validate that it is accurate, and update it with what we know. If it sounds like this is dodgy, I wouldn't disagree, but in practice this seems to work really well.</p>

<p>Lastly, we need to be able to redirect a symlink, even when it is in use.  This seems trivial enough to do with junctions, but with files, we have to resort to moving the file out of the way, and creating a new linked file (which we can do, even if the file locked).</p>

<p>Admittedly, there are a few limitations that this design has:</p>

<ul>
<li>Symlinks are only supported on the local system (no cross volume links, nor can they link to UNC paths)</li>
<li>Symlinks must be absolute references (not linking to relative paths)</li>
<li>The relationship between the linked file and the canonical file is potentially ephemeral, but simple examination of the files allows us to rebuild the information.</li>
<li>In the worst case scenario, if files get unlinked, they still work as regular files.</li>
</ul>

<p>Luckily, CoApp's requirements for what symbolic links need to do doesn't have to be as flexible as full blown symlinks, and these limitations are not a hindrance at all.</p>

<p>I've just added this code to the CoApp toolkit (written in C#), and I'll be playing with it quite a bit over the next few weeks. Once I'm sure that everything works as I like, if there is interest, I may implement a pure native version of the code so that other utilities and software can do the same thing and play nice too.</p>
</div>

<!-- Disqus Comment System -->
<div id="disqus_thread"><div id="dsq-content"></div></div>
<ul id="dsq-comments"></ul>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'coapp'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    
    var disqus_identifier = '/news/2011-04-07-Simulating-symlinks-for-Windows-XP-2003.html';
    var disqus_url = 'http://www.coapp.org/news/2011-04-07-Simulating-symlinks-for-Windows-XP-2003.html';
    var disqus_title = "Simulating Symlinks for Windows XP/2003";
    var disqus_developer = 0; 
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </div>
        </section>
    </div>  
    <br>    
    <div class="push" ></div>
    </div>
    <footer class="footer">
        <div class="container-fluid">
        <p  style="float:left;">&copy; CoApp Contributors, 2011. 
        <br><sub>The source for this page can be found <a href="https://github.com/coapp/coapp.org/blob/master/src/dynamic/news/2011-04-07-Simulating-symlinks-for-Windows-XP-2003.html.md">in the github repository.</a></sub>
        </p>
        <p style="float:right;">
            This website was generated on Apr 06 2012 and has 148 documents
        </p>
        </div>
    </footer>
</body>
</html>