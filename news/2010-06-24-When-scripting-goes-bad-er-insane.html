<!DOCTYPE html>

<html lange="en">
<head>
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>CoApp - When scripting goes bad...er, insane.</title>
    <meta name="description" content="">
    <meta name="author" content="Garrett Serack">

    <meta property="og:title" content="CoApp - When scripting goes bad...er, insane."/>
    
        <meta property="og:type" content="article"/>
    
    <meta property="og:image" content="http://coapp.org/images/logo-small.png"/>
    <meta property="og:url" content="http://coapp.org/news/2010-06-24-When-scripting-goes-bad-er-insane.html"/>
    <meta property="og:site_name" content="CoApp"/>
    <meta property="og:admins" content="CoApp - fearthecowboy"/>

    <meta name="docid" content="news:20100624" />
    <meta name="srclocation" content="https://github.com/coapp/coapp.org/blob/master/src/dynamic/news/2010-06-24-When-scripting-goes-bad-er-insane.html.md" />

    <!-- Icons -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

    <!-- Shims: IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script async src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Styles -->
    <link href="/styles/style.css" rel="stylesheet"/>
    <link href="/styles/prettify.css" rel="stylesheet"/>
    <link href="/styles/mediaelementplayer.min.css" rel="stylesheet"  />
    
</head>
<body >
    
    <!-- Scripts -->
    <script src="/scripts/jquery-1.6.4.min.js"></script>
    <script src="/scripts/prettify.js"></script>
    <script src="/scripts/jquery.tweet.js"></script>
    <script src="/scripts/mediaelement-and-player.js"></script>
    <script src="/scripts/bootstrap/bootstrap-dropdown.js"></script>
    <div id="fb-root"></div>
      <script type="text/javascript">
      (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
      })();
      </script>
      <script type="text/javascript">
      (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    </script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-15630590-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <script>
        // $('#topbar').dropdown();
    </script>
    <!-- Markup -->
    <div class="topbar" data-dropdown="dropdown">
        <div class="fill">
            <div class="container-fluid">
                <h3><a href="/index.html"><image style="margin:0; padding:0; position:absolute; top:2px; left:-2px;" src="/images/logo-small_32x32.png"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CoApp</a></h3>
                <ul>
                      
                        
                        <li typeof="sioc:Page" about="/pages/news.html" class="">
                            <a href="/pages/news.html" property="dc:title">News</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/help.html" class="">
                            <a href="/pages/help.html" property="dc:title">Help</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/packages.html" class="">
                            <a href="/pages/packages.html" property="dc:title">Packages</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/publishers.html" class="">
                            <a href="/pages/publishers.html" property="dc:title">Publishers</a>
                        </li>

                        
                      
                        
                        <li class="dropdown" >
                            <a href="#" class="dropdown-toggle">Developers</a>
                            <ul class="dropdown-menu">
                                <li><a href="/pages/developers">Developer Tutorials</a></li>
                                <li class="divider"></li>
                                <li><a href="http://github.com/coapp"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp Source Repositories</a></li>
                                <li><a href="http://github.com/coapp-packages"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub"> Package Source Repositories</a></li>
                                <li class="divider"></li>
                                <li><a href="https://github.com/coapp/coapp.org/wiki"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > Developer Wiki</a></li>
                                <li><a href="https://github.com/coapp/coapp/issues"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp Bugtracker</a></li>
                                <li><a href="https://github.com/coapp/devtools/issues"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > DevTools Bugtracker</a></li>
                                <li class="divider"></li>
                                <li><a href="http://github.com/organizations/coapp"><img style="margin-bottom:-3px;" src="/images/github.png" title="GitHub" > CoApp GitHub Home</a></li>
                            </ul>
                        </li>
                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/reference.html" class="">
                            <a href="/pages/reference.html" property="dc:title">Reference</a>
                        </li>

                        
                      
                        
                        <li typeof="sioc:Page" about="/pages/about.html" class="">
                            <a href="/pages/about.html" property="dc:title">About</a>
                        </li>

                        
                    
                </ul>
                
                
            </div>
        </div>
    </div>
    <div class="wrapper">
    <div class="container-fluid pushdown">
        <div class="sidebar">
            
        </div> 
        <section id="content" class="content">
        <div class="spanonethird rightsidebox" > <!-- float:right; display: inline; veritical-align:top; -->
            
        </div> 
            <div class="spantwothirds">
            


<span style="display:inline-block;">
    <h1>When scripting goes bad...er, insane.</h1>
    <p>Jun 24 2010 by <b>Garrett Serack</b> <a href="http://twitter.com/#!/fearthecowboy">@fearthecowboy</a><br>
    <span class="label warning">Tags</span><span style="display:inline-block;">developer,coding</span></p>
</span>
<span style="display:inline-block; float:right;">
    <br><br>
    <span style="margin-top:8px; height;100%; display:inline-block; "><g:plusone href="http://coapp.org/news/2010-06-24-When-scripting-goes-bad-er-insane.html"></g:plusone></span>
    <div class="fb-like" style="top:-5px;" data-href="http://coapp.org/news/2010-06-24-When-scripting-goes-bad-er-insane.html" data-layout="button_count" data-show-faces="true" data-colorscheme="dark" data-font="tahoma"></div>
</span>  
<hr>
<div id="post" class="post">
    <p>Hi, my name is Garrett, and I have a problem.</p>

<p>I love scripting stuff. And, I by stuff, I mean everything. Really, I often use it as an exercise to understanding whatever it is that I'm trying to learn - if I can automate it, I've got a strong feeling that I understand it.</p>

<p>As you may or may not know, my absolute favorite language is JavaScript (and its many incarnations, like JScript). My love for JavaScript even predates the existence of JavaScript - I heavily used a scripting language called C - (C minus minus aka 'Cmm', later renamed to ScriptEase). A somewhat forgotten company called <strong>Nombas</strong> had written it. A clip from the wayback machine (<a href='http://bit.ly/dCjRd9'>http://bit.ly/dCjRd9</a>):</p>

<blockquote>
  <p>In 1992 and 1993 Nombas developed a language named Cmm (for C minus minus, or "C<br />without the hard stuff") for use as an embeddable scripting language, showing that<br />it was possible to have a full-powered language that was simple enough to replace<br />macro languages. Years later we would change the language name to ScriptEase, because<br />Cmm was "too negative, and the letter 'C' scared people". Cmm was first released in a<br />shareware product called CEnvi, which won awards and fame and is now available as ScriptEase:Desktop.</p>
  
  <p>When Netscape's first commercial browsers were released we made a version of CEnvi that<br />could handle short scripts embedded within web pages. By embedded scripts within the<br />page we allowed the client side to handle processing, rather than making all dynamic<br />interaction happen on the server. This brought immediate client-side interaction with<br />the user. The advantages of client-side handling were made obvious by Nombas' "Espresso<br />Pages", and Netscape soon began work on their own version, which they called LiveScript,<br />and then renamed to JavaScript just before its final release.</p>
</blockquote>

<p>Cmm and JavaScript were so similar anyway, it was inevitable that one of them would perform the necessary course corrections and become like the other.  Regardless of the specific flavor, for me, the notion of a dynamic c-style scripting language has always had extremely strong appeal.</p>

<p>Over the last 15 or so years, I continued to use JavaScript (or JScript) whenever I needed a script, and I've been very happy.  As well, I continued to refine some of my scripting techniques and create some rather clever hacks to do a lot of the things I needed to do.</p>

<p>The real problem began when I needed to do some batch scripting-that is some useful scripting of command lines and whatnot. On Windows (out of the box), there are only a couple of options: Batch scripting with CMD, and in later years, PowerShell. For a long time, I used CMD Batch Scripting for lots of this, but it's so ... so ... nasty. You really don't want to do serious work in there, it's just not up to the task.</p>

<p>PowerShell should have made me ecstatic-a .NET language, with access to pretty much everything I ever wanted in a scripting language, tons of support, and clearly the answer to my problems.  Unfortunately, that syntax breaks my brain. I just can't get natural with it, no matter how much I've tried.</p>

<p>So, a couple of years ago, I started writing a nifty library that allowed me to make complicated batch scripts using JScript; and it's been working out nicely. I get access to everything in the OS that I need, the language is installed on every version of Windows that I have used, and it doesn't require any magic to make work.  Over time, I've added in code to do some 'theoretically impossible' tasks in JScript, including:</p>

<ul>
<li>full support for batch scripting (capturing and using the results of other command line apps)</li>
<li>full use of environment variables in scripting</li>
<li>formatted string handling</li>
<li>binary file read and write (and they said it couldn't be done)</li>
<li>some basic file assertions</li>
<li>http downloading</li>
<li>logging</li>
<li>PE executable identification</li>
<li>process management</li>
<li>an extensible library interface and libraries for Restore Points, Speech (SAPI), JSON, MD5, Hyper-V VHD handling, and a twisted on-the-fly C# compiler.</li>
</ul>

<p>And probably some other things I can't remember.</p>

<h2>Here's where it starts to get weird</h2>

<p>Then, last night I was doing some more batch scripting at home, and I had my insane idea. What if I wrote a script that transformed a batch-like script language into JScript, and executed it. And, just because I'm that crazy, I'll write it in JScript too.</p>

<p>And now, a scan hundred or so lines later, my latest script language is born. I call it 'gs' - short for gScript... a cousin to my other (unreleased) scripting language g#.</p>

<p>A quick little example script:</p>


<p>
<div class="highlight"><pre>// comments are still slashies

// you can execute command lines just like regular batch languages:
// (this just prints the robocopy usage)
robocopy

// Or you can capture the results of a command:
// (this uses the command processor to get a list of files (as text))
var $RESULT = cmd /c dir /b c:\*.zip

// there are built-in commands:
// so far cd, md, rd, erase, echo, dir
echo {$RESULT}

// and when you want to do some jscript, start a jscript block:
js {
    // this is a jscript code block
    //any legal jscript is ok here!

    // of course, you have access to the js.js function library:
    print(&quot;hello World&quot;);

    // and functions work just fine:
    function foo() {

        // you can even run batch commands from where with hash-bang:
        $WGETHELP = #! wget --help

        #! cmd.exe /c ver

        // output from the last command is always captured as an array in
        // $StdOut and as a string in $StdOutString
        print($StdOutString);

        return $WGETHELP;
    }

}

// oh, and for loops work outside the js blocks in the batch-world too:
// prints out text:
for(var i=0;i&lt;10;i++)
    echo {$RESULT} {i}
</pre></div>

<p>

<p>using the gs script runner to run this:</p>


<p>
<div class="highlight"><pre>C:\&gt;gs test.gs

( or, to dump the processed script out )

C:\&gt;gs /debug test.gs

// comments are still slashies

// you can execute command lines just like regular batch languages:
// (this just prints the robocopy usage)
$$(&quot;robocopy&quot;);

// Or you can capture the results of a command:
// (this uses the command processor to get a list of files (as text))
var $RESULT = $$.RunQuiet(&quot;cmd /c dir /b c:\\*.zip&quot;);

// there are built-in commands:
// so far cd, md, rd, erase, echo, dir
print(&#39;{$RESULT}&#39;);

// and when you want to do some jscript, start a jscript block:

    // this is a jscript code block
    //any legal jscript is ok here!

    // of course, you have access to the js.js function library:
    print(&quot;hello World&quot;);

    // and functions work just fine:
    function foo() {

        // you can even run batch commands from where with hash-bang:
        $WGETHELP = $$.RunQuiet(&quot;wget --help&quot;);

        $$(&quot;cmd.exe /c ver&quot;);

        // output from the last command is always captured as an array in
        // $StdOut and as a string in $StdOutString
        print($StdOutString);

        return $WGETHELP;
    }

// oh, and for loops work outside the js blocks in the batch-world too:
// prints out text:
for(var i=0;i&lt;10;i++)
print(&#39;{$RESULT} {i}&#39;);
</pre></div>

<p>

<p>I've skimmed over so much of how this all works, but feel free to play with the code.  Some of this I published earlier in my gsToolkit project on Codeplex.  I'm using all of this in the CoApp project for a variety of tasks, so I'm publishing the whole set in a <a href="http://coapp.org">CoApp</a> project.</p>
</div>

<!-- Disqus Comment System -->
<div id="disqus_thread"><div id="dsq-content"></div></div>
<ul id="dsq-comments"></ul>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'coapp'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    
    var disqus_identifier = '/news/2010-06-24-When-scripting-goes-bad-er-insane.html';
    var disqus_url = 'http://www.coapp.org/news/2010-06-24-When-scripting-goes-bad-er-insane.html';
    var disqus_title = "When scripting goes bad...er, insane.";
    var disqus_developer = 0; 
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </div>
        </section>
    </div>  
    <br>    
    <div class="push" ></div>
    </div>
    <footer class="footer">
        <div class="container-fluid">
        <p  style="float:left;">&copy; CoApp Contributors, 2011. 
        <br><sub>The source for this page can be found <a href="https://github.com/coapp/coapp.org/blob/master/src/dynamic/news/2010-06-24-When-scripting-goes-bad-er-insane.html.md">in the github repository.</a></sub>
        </p>
        <p style="float:right;">
            This website was generated on Feb 08 2012 and has 138 documents
        </p>
        </div>
    </footer>
</body>
</html>